(()=>{"use strict";var e={20:(e,t,o)=>{var l=o(609),n=Symbol.for("react.element"),r=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),i=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,o){var l,s={},p=null,c=null;for(l in void 0!==o&&(p=""+o),void 0!==t.key&&(p=""+t.key),void 0!==t.ref&&(c=t.ref),t)r.call(t,l)&&!a.hasOwnProperty(l)&&(s[l]=t[l]);if(e&&e.defaultProps)for(l in t=e.defaultProps)void 0===s[l]&&(s[l]=t[l]);return{$$typeof:n,type:e,key:p,ref:c,props:s,_owner:i.current}}},848:(e,t,o)=>{e.exports=o(20)},609:e=>{e.exports=window.React}},t={};function o(l){var n=t[l];if(void 0!==n)return n.exports;var r=t[l]={exports:{}};return e[l](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var l in t)o.o(t,l)&&!o.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var l=o(609);const n=window.wp.i18n,r=window.wp.blocks,i=window.wp.blockEditor,a=window.wp.element,s=window.wp.data,p=window.wp.serverSideRender;var c=o.n(p);const u=window.wp.components,m=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mpg/loop","version":"0.1.0","title":"MPG Loop","category":"design","icon":"database-view","description":"MPG Loop block to build rich content based on the MPG project data","attributes":{"project_id":{"type":"integer","default":0},"limit":{"type":"integer","default":5},"uniqueRows":{"type":"boolean","default":false},"logic":{"type":"string","enum":["and","or"],"default":"and"},"orderBy":{"type":"string","default":""},"direction":{"enum":["asc","desc","random",""],"type":"string","default":""},"innerBlocksContent":{"type":"string","default":""},"conditions":{"type":"object","default":{"conditions":[],"logic":"all"},"properties":{"conditions":{"type":"array","items":{"type":"object","properties":{"column":{"type":"string"},"operator":{"type":"string"},"value":{"type":"string"}}}},"logic":{"type":"string","enum":["all","any"]}}}},"supports":{"align":["wide","full"],"anchor":true,"ariaLabel":true,"html":true,"color":{"gradients":true,"heading":true,"button":true,"link":true},"shadow":true,"spacing":{"margin":["top","bottom"],"padding":true,"blockGap":true},"dimensions":{"minHeight":true},"typography":{"fontSize":true,"lineHeight":true}},"editorScript":"file:./index.js","editorStyle":"file:./editor.css","textdomain":"multi-pages-plugin"}'),d=window.wp.primitives;var g=o(848);const w=(0,g.jsx)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,g.jsx)(d.Path,{d:"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"})}),_=(0,g.jsx)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,g.jsx)(d.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),b=(0,g.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(d.Path,{d:"m13.06 12 6.47-6.47-1.06-1.06L12 10.94 5.53 4.47 4.47 5.53 10.94 12l-6.47 6.47 1.06 1.06L12 13.06l6.47 6.47 1.06-1.06L13.06 12Z"})}),v=(0,g.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(d.Path,{d:"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z"})}),y=({conditions:e,updateConditions:t,operators:o,CompareOperators:r,labels:i={},columnOptions:s})=>{const[p,c]=(0,a.useState)([]),m={applyFilters:(0,n.__)("How to Apply Filters","multi-pages-plugin"),matchAll:(0,n.__)("Show items that match all filters","multi-pages-plugin"),matchAny:(0,n.__)("Show items that match any filter","multi-pages-plugin"),emptyFilter:(0,n.__)("Empty filter","multi-pages-plugin"),collapse:(0,n.__)("Collapse","multi-pages-plugin"),expand:(0,n.__)("Expand","multi-pages-plugin"),removeFilter:(0,n.__)("Remove filter","multi-pages-plugin"),column:(0,n.__)("Column","multi-pages-plugin"),selectColumn:(0,n.__)("Select a column...","multi-pages-plugin"),operator:(0,n.__)("Operator","multi-pages-plugin"),value:(0,n.__)("Value","multi-pages-plugin"),addFilter:(0,n.__)("Add filter","multi-pages-plugin"),...i},d=(o,l,n)=>{const r=[...e.conditions];r[o][l]=n,t({...e,conditions:r})},g=e=>{if(!e.column)return m.emptyFilter;let t=`${e.column}`;return e.operator&&(t+=` ${y(e.operator).toLowerCase()}`,r.includes(e.operator)&&e.value&&(t+=` ${e.value}`)),{short:t.length>15?t.substring(0,12)+"...":t,full:t}},y=e=>{const t=o.find((t=>t.value===e));return t?t.label:e};return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(u.SelectControl,{label:m.applyFilters,value:e.logic,options:[{label:m.matchAll,value:"all"},{label:m.matchAny,value:"any"}],onChange:o=>{t({...e,logic:o})}}),e.conditions.map(((n,i)=>(0,l.createElement)("div",{key:i,style:{marginBottom:"10px",padding:"0px 10px",border:"1px solid #ccc"}},(0,l.createElement)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},(0,l.createElement)("strong",{title:g(n).full},g(n).short),(0,l.createElement)("div",null,(0,l.createElement)(u.IconButton,{icon:p[i]?w:_,label:p[i]?m.collapse:m.expand,onClick:()=>(e=>{c((t=>{const o=[...t];return o[e]=!o[e],o}))})(i)}),(0,l.createElement)(u.IconButton,{icon:b,label:m.removeFilter,onClick:()=>(o=>{const l=[...e.conditions];l.splice(o,1),t({...e,conditions:l})})(i)}))),p[i]&&(0,l.createElement)(l.Fragment,null,s?(0,l.createElement)(u.SelectControl,{label:m.column,value:n.column,options:[{value:"",label:m.selectColumn},...s],onChange:e=>d(i,"column",e)}):(0,l.createElement)(u.TextControl,{label:m.column,value:n.column,onChange:e=>d(i,"column",e)}),(0,l.createElement)(u.SelectControl,{label:m.operator,value:n.operator,options:o,onChange:e=>d(i,"operator",e)}),r.includes(n.operator)&&(0,l.createElement)(u.TextControl,{label:m.value,value:n.value,onChange:e=>d(i,"value",e)}))))),e.conditions.length<10&&(0,l.createElement)(u.Button,{isSecondary:!0,onClick:()=>{if(e.conditions.length<10){const l=e.conditions.length;t({...e,conditions:[...e.conditions,{column:"",operator:o[0].value,value:""}]}),c((e=>{const t=[...e];return t[l]=!0,t}))}},icon:v},m.addFilter))},{name:h}=m;(0,r.registerBlockType)(h,{...m,edit:({attributes:e,setAttributes:t,clientId:o})=>{const{project_id:r,direction:p,conditions:m}=e,d=(0,i.useBlockProps)();(0,a.useEffect)((()=>{}),[e]);const[g,w]=(0,a.useState)(!1),[_,b]=(0,a.useState)(""),{selectBlock:v}=(0,s.useDispatch)("core/block-editor"),h=window.mpgLoop?Object.entries(window.mpgLoop.projects).map((([e,t])=>({value:e,label:t}))):[],f=window.mpgLoop?Object.entries(window.mpgLoop.orders).map((([e,t])=>({value:e,label:t}))):[],E=(0,s.useSelect)((e=>{const{isBlockSelected:t,hasSelectedInnerBlock:l}=e("core/block-editor");return t(o)||l(o,!0)}),[o]);(0,a.useEffect)((()=>{E&&w(!1)}),[E]);const{getBlocks:C}=(0,s.useSelect)((e=>e("core/block-editor")));(0,a.useEffect)((()=>{const e=()=>{const e=C(o),t=wp.blocks.serialize(e);b(t)};e();const t=wp.data.subscribe((()=>{e()}));return()=>t()}),[o,C]);const k=window.mpgLoop&&r?window.mpgLoop.projectHeaders[r]:[],x=window.mpgLoop.operators||[],S=k.map((e=>({value:e,label:e}))),B=Object.entries(x).map((([e,t])=>({label:t,value:e}))),j=Object.keys(window.mpgLoop.compareOperators)||[],O=(0,s.useSelect)((e=>{const{getBlockOrder:t}=e("core/block-editor");return t(o).length>0}),[o]);return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(i.InspectorControls,null,(0,l.createElement)(u.PanelBody,{className:"mpg-loop-settings",title:(0,n.__)("Loop Settings","multi-pages-plugin")},(0,l.createElement)(u.SelectControl,{label:(0,n.__)("Select Project","multi-pages-plugin"),value:e.project_id,options:[{value:0,label:(0,n.__)("Select a project...","multi-pages-plugin")},...h],onChange:e=>{t({project_id:parseInt(e)}),w(!1)}}),r>0&&(0,l.createElement)(l.Fragment,null,(0,l.createElement)(u.TextControl,{label:(0,n.__)("Limit","multi-pages-plugin"),value:e.limit,type:"number",onChange:e=>t({limit:parseInt(e)}),help:(0,n.__)("Number of maximum items to display.","multi-pages-plugin")}),(0,l.createElement)(u.ToggleControl,{label:(0,n.__)("Unique Rows","multi-pages-plugin"),checked:e.uniqueRows,onChange:e=>t({uniqueRows:e}),help:(0,n.__)("Display only unique rows","multi-pages-plugin")}),(0,l.createElement)(u.SelectControl,{label:(0,n.__)("Ordering","multi-pages-plugin"),value:e.direction,options:[{value:"",label:(0,n.__)("...","multi-pages-plugin")},...f],onChange:e=>t({direction:e})}),("asc"===p||"desc"===p)&&(0,l.createElement)(u.SelectControl,{label:(0,n.__)("Order By","multi-pages-plugin"),value:e.orderBy,options:[{value:"",label:(0,n.__)("Select a column...","multi-pages-plugin")},...S],onChange:e=>t({orderBy:e}),help:(0,n.__)("Column name to order by","multi-pages-plugin")}),(0,l.createElement)(u.Button,{isPrimary:!0,onClick:()=>{w(!0),v(null)}},(0,n.__)("Preview Loop","multi-pages-plugin")))),(0,l.createElement)(u.PanelBody,{title:(0,n.__)("Loop Filters","multi-pages-plugin"),initialOpen:!0,className:"mpg-loop-filters "+(r>0?"":"hidden"),insertAfter:"mpg-loop-settings"},(0,l.createElement)(y,{conditions:m,updateConditions:e=>{t({conditions:e})},columnOptions:S,operators:B,CompareOperators:j}))),(0,l.createElement)("div",{...d},g&&!E?(0,l.createElement)(c(),{block:"mpg/loop",attributes:{...e,innerBlocksContent:_},httpMethod:"POST"}):(0,l.createElement)(i.InnerBlocks,{renderAppender:()=>O?(0,l.createElement)(i.InnerBlocks.DefaultBlockAppender,null):(0,l.createElement)(i.ButtonBlockAppender,{rootClientId:o,className:"wp-block-mpg-loop__appender"})})))},save:()=>{const e=i.useBlockProps.save();return(0,l.createElement)("div",{...e},(0,l.createElement)(i.InnerBlocks.Content,null))}})})();